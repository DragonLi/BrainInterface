<UserControl x:Class="Abt.Controls.SciChart.Example.Examples.IWantTo.CreateStockCharts.MultiPane.CreateMultiPaneStockCharts"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:s="http://schemas.abtsoftware.co.uk/scichart"
             xmlns:common="clr-namespace:Abt.Controls.SciChart.Example.Common"
             xmlns:multiPane="clr-namespace:Abt.Controls.SciChart.Example.Examples.IWantTo.CreateStockCharts.MultiPane"
             mc:Ignorable="d" 
             d:DesignHeight="300" d:DesignWidth="600">
    
    <UserControl.Resources>
        
        <!-- This allows setting the Height of a pane from a viewmodel -->
        <Style x:Key="ChartPaneStyle" TargetType="s:SciChartGroupPane">
            <Setter Property="Height" Value="{Binding PaneViewModel.Height, Mode=TwoWay}"/>
        </Style>

        <!-- A number of converters which change parameters of charts based on the IsFirstChartPane property -->
        <common:BoolToValueConverter x:Key="MinorsPerMajorConverter" TrueValue="4" FalseValue="2"/>
        <common:BoolToValueConverter x:Key="MaxAutoTicksConverter" TrueValue="8" FalseValue="4"/>
        <common:BoolToValueConverter x:Key="GrowByConverter" >
            <common:BoolToValueConverter.TrueValue>
                <s:DoubleRange Min="0.05" Max="0.05"/>
            </common:BoolToValueConverter.TrueValue>
            <common:BoolToValueConverter.FalseValue>
                <s:DoubleRange Min="0.0" Max="0.0"/>
            </common:BoolToValueConverter.FalseValue>
        </common:BoolToValueConverter>

    </UserControl.Resources>
    
    <Grid>

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        
        <!-- Databinds a SciChartGroup to a list of ChartPaneViewModels -->
        <!-- Child chart panes are generated using the ItemTemplate below -->
        <s:SciChartGroup Grid.Row="1" 
                         ItemsSource="{Binding ChartPaneViewModels}"
                         s:ThemeManager.Theme="{Binding ElementName=ThemeCombo, Path=SelectedItem}"
                         ItemContainerStyle="{StaticResource ChartPaneStyle}">
            <s:SciChartGroup.ItemTemplate>
                <DataTemplate>
                    
                    <!-- Databinds each child SciStockChart to ... -->
                    <!-- SeriesSource to BaseChartPaneViewModel.ChartSeriesViewModels -->
                    <!-- Axis Properties, like s:StockChartXAxis.VisibleRange to CreateMultiPaneStockChartsViewModel.XVisibleRange -->
                    <!-- Axis Properties, like s:StockChartYAxis.GrowBy to BaseChartPaneViewModel.IsFirstChartPane with a converter to change behaviour based on pane position-->                    

                    <s:SciStockChart Padding="0" 
                                     BorderThickness="0,0,1,1"
                                     IsXAxisVisible="{Binding IsFirstChartPane}"     
                                     IsPanEnabled="{Binding ParentViewModel.IsPanEnabled}"
                                     IsRubberBandZoomEnabled="{Binding ParentViewModel.IsZoomEnabled}"                                                                                                                                           
                                     VerticalChartGroupId="{Binding ParentViewModel.VerticalChartGroupId}"    
                                     ViewportManager="{Binding ParentViewModel.ViewportManager}"
                                     SeriesSource="{Binding ChartSeriesViewModels}">
                        
                        <!-- Override any properties of the built-in CategoryDateTimeAxis -->
                        <s:SciStockChart.XAxisStyle>
                            <Style TargetType="s:CategoryDateTimeAxis">
                                <Setter Property="DrawMajorBands" Value="True"/>
                                <Setter Property="DrawMinorGridLines" Value="False"/>
                                <Setter Property="VisibleRange" Value="{Binding ParentViewModel.XVisibleRange, Mode=TwoWay}"/>
                                <Setter Property="GrowBy" Value="0, 0.05"/>
                            </Style>
                        </s:SciStockChart.XAxisStyle>
                        
                        <!-- Override any properties of the built-in NumericAxis -->
                        <s:SciStockChart.YAxisStyle>
                            <Style TargetType="s:NumericAxis">
                                <Setter Property="TextFormatting" Value="{Binding YAxisTextFormatting}"/>
                                <Setter Property="AutoRange" Value="Always"/>
                                <Setter Property="MinorsPerMajor" Value="{Binding IsFirstChartPane, Converter={StaticResource MinorsPerMajorConverter}}"/>
                                <Setter Property="MaxAutoTicks" Value="{Binding IsFirstChartPane, Converter={StaticResource MaxAutoTicksConverter}}"/>
                                <Setter Property="GrowBy" Value="{Binding IsFirstChartPane, Converter={StaticResource GrowByConverter}}"/>
                            </Style>
                        </s:SciStockChart.YAxisStyle>
                        
                    </s:SciStockChart>
                </DataTemplate>
            </s:SciChartGroup.ItemTemplate>
        </s:SciChartGroup>

        <!--  ** IGNORE BELOW HERE **  -->
        <!--  Define the Toolbar  -->

        <StackPanel Grid.Row="0"
                    Margin="2,4"
                    Orientation="Horizontal">

            <ToggleButton Margin="2"
                          Command="{Binding PanModeCommand}"
                          s:ToggleButtonExtensions.GroupName="Modifiers">
                <StackPanel Orientation="Horizontal">
                    <Image Margin="3"
                           Source="/Abt.Controls.SciChart.Example;component/Resources/Images/cursor_drag_arrow_2.png"
                           Stretch="None" />
                    <TextBlock Margin="3" Text="Pan" />
                </StackPanel>
            </ToggleButton>

            <ToggleButton Margin="2"
                          Command="{Binding ZoomModeCommand}"
                          s:ToggleButtonExtensions.GroupName="Modifiers"
                          IsChecked="True">
                <StackPanel Orientation="Horizontal">
                    <Image Margin="3"
                           Source="/Abt.Controls.SciChart.Example;component/Resources/Images/zoom.png"
                           Stretch="None" />
                    <TextBlock Margin="3" Text="Zoom" />
                </StackPanel>
            </ToggleButton>

            <Button Margin="2" Command="{Binding ZoomExtentsCommand}">
                <StackPanel Orientation="Horizontal">
                    <Image Margin="3"
                           Source="/Abt.Controls.SciChart.Example;component/Resources/Images/fit_to_size.png"
                           Stretch="None" />
                    <TextBlock Margin="3" Text="Zoom Extents" />
                </StackPanel>
            </Button>

            <Line Margin="5"
                  Stroke="Gray"
                  Y2="16" />

            <TextBlock Text="Theme:" Margin="5" Foreground="White"></TextBlock>
            <ComboBox x:Name="ThemeCombo"
                      Margin="5,3"
                      ItemsSource="{Binding AllThemes}"
                      SelectedItem="BlackSteel" />

        </StackPanel>
        
    </Grid>
</UserControl>
